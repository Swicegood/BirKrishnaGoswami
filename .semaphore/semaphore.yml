version: v1.0
name: Expo Web App Pipeline
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu2004

blocks:
  - name: Build
    task:
      env_vars:
        - name: NODE_ENV
          value: production
      jobs:
        - name: Export Expo Web
          commands:
            - checkout
            - node --version
            - npm --version
            - npm install
            - npm install expo
            - npx expo install expo-build-properties 
            - ls
      secrets:
       - name: VPS

  - name: Deploy
    task:
      jobs:
        - name: Deploy to VPS
          commands:
            - checkout
            - ssh-keyscan -H $VPS_IP >> ~/.ssh/known_hosts
            - 'scp -r dist/* $VPS_USER@$VPS_IP:/public_html/'
      secrets:
        - name: VPS_IP
        - name: VPS_USER